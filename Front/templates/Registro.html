{% extends 'base.html' %}

{% block mi-contenido %}
    {% include 'barra-navegación.html' %}
    <style>
        body{
            background-image: none;
        }
        .login-box input {
            margin-bottom: 20px;
        }
        .titulo-superior-movil{
            margin-bottom: 20px;
        }
        @media (max-width: 440px) {
            .contenedor-logo{
                display: none;
            }
            header{
                display: none;
            }
        }
    </style>
    <div class="login-container">
        <div class="login-box">
            <div class="titulo-superior-movil">
                <a href="{% url 'Inicio' %}"><img src="../static/image/Flecha.svg" alt="Flecha"> </a>
                <h2 >REGISTRARSE</h2>
            </div>
            <form id="registration-form" method="POST">
                {% csrf_token %}
                <label for="username">Nombre de Entidad</label>
                <input type="text" id="username" name="username" required>

                <label for="email">Correo Electronico</label>
                <input type="email" id="email" name="email" required>
                <small class="small small1" id="email-error" style="color: red; display: none;">
                    Por favor, ingresa un correo válido.
                </small>

                <label for="password">Contraseña</label>
                <input type="password" id="password" name="password" required>
                <small class=" small small2" id="error-message" style="color: red; display: none;">
                   8 caracteres, incluyendo letras, números y signos.
                </small>
                {% if messages %}
                    <div class="messages">
                        {% for message in messages %}
                            <p style="color: red; ">{{ message }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
                <button type="submit" onclick="return confirm('Usuario registrado correctamente')"> REGISTRARSE </button>
                <p class="t">¿Ya tienes una cuenta? <a href="{% url 'IniciarSesión' %}">Iniciar Sesión</a></p>
            </form>
            </div>
            <div class="icon-container">
                <img src="../static/image/Icono-principal-azul.svg" alt="Lock Icon">
            </div>
        </div>

    </div>
    <script>
        const form = document.getElementById('registration-form');
        const emailInput = document.getElementById('email');
        const emailError = document.getElementById('email-error');
        const passwordInput = document.getElementById('password');
        const passwordError = document.getElementById('error-message');
    
        // Expresiones regulares para validación
        const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
    
        // Validación en tiempo real del correo
        emailInput.addEventListener('input', () => {
            const value = emailInput.value.trim();
    
            if (value === '') {
                emailError.style.display = 'none'; // Oculta el mensaje si el campo está vacío
            } else if (emailRegex.test(value)) {
                emailError.style.display = 'none'; // Oculta el mensaje si el correo es válido
            } else {
                emailError.style.display = 'block'; // Muestra el mensaje si el correo es inválido
            }
        });
    
        // Validación en tiempo real de la contraseña
        passwordInput.addEventListener('input', () => {
            const value = passwordInput.value.trim();
    
            if (value === '') {
                passwordError.style.display = 'none'; // Oculta el mensaje si el campo está vacío
            } else if (passwordRegex.test(value)) {
                passwordError.style.display = 'none'; // Oculta el mensaje si la contraseña es válida
            } else {
                passwordError.style.display = 'block'; // Muestra el mensaje si la contraseña es inválida
            }
        });
    
        // Validación al enviar el formulario
        form.addEventListener('submit', (e) => {
            let isValid = true;
    
            // Validar correo electrónico
            if (emailInput.value.trim() === '' || !emailRegex.test(emailInput.value.trim())) {
                emailError.style.display = 'block'; // Muestra el mensaje si el correo no es válido
                isValid = false;
            }
    
            // Validar contraseña
            if (passwordInput.value.trim() === '' || !passwordRegex.test(passwordInput.value.trim())) {
                passwordError.style.display = 'block'; // Muestra el mensaje si la contraseña no es válida
                isValid = false;
            }
    
            // Si alguna validación falla, se evita el envío del formulario
            if (!isValid) {
                e.preventDefault();
                alert('Por favor, corrige los errores antes de enviar.');
            }
        });
    </script>
{% endblock %}